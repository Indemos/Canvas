@page "/map"

@using Canvas.Core
@using Canvas.Core.Composers
@using Canvas.Core.Engines
@using Canvas.Core.Enums;
@using Canvas.Core.Models
@using Canvas.Core.Shapes
@using Canvas.Core.Services
@using ScriptContainer
@using SkiaSharp;

<div class="demo">
  <CanvasView @ref="View"></CanvasView>
</div>

<style type="text/css">
  .demo {
    display: flex;
    flex-grow: 1;
    height: 100%;
  }
</style>

@code
{
  public CanvasView View { get; set; }

  protected override async Task OnAfterRenderAsync(bool setup)
  {
    if (setup)
    {
      var min = 0;
      var max = 5;
      var generator = new Random();
      var colorService = new ColorService { Min = min, Max = max, Mode = ShadeEnum.Intensity };
      var indexLabels = new[] { "CAD", "DKK", "NZD", "SGD", "UAH", "NOK", "JPY", "CNY", "INR", "SEK" };
      var valueLabels = new[] { "USD", "EUR", "CHF", "AUD", "GBP" };
      var points = Enumerable.Range(0, indexLabels.Length).Select(i => new ColorMapShape
      {
        Points = Enumerable
          .Range(min, max)
          .Select(o => new ComponentModel { Size = o, Color = colorService.GetColor(o) })
          .OrderBy(o => generator.Next())
          .ToList()

      } as IShape).ToList();

      var composer = new MapComposer
      {
        Name = "Correlation",
        Items = points,
        View = View,
        ValueCount = valueLabels.Length,
        ShowIndex = (i, o) => indexLabels.ElementAtOrDefault((int)i),
        ShowValue = (i, o) => valueLabels.ElementAtOrDefault((int)i),
        ShowMarkerIndex = (i) => indexLabels.ElementAtOrDefault((int)i),
        ShowMarkerValue = (i) => valueLabels.ElementAtOrDefault((int)(valueLabels.Length - i))
      };

      await composer.Create<CanvasEngine>();
      await composer.Update();
    }

    await base.OnAfterRenderAsync(setup);
  }
}
